name: Manual VCV Rack Plugin Build

on:
workflow_dispatch:

jobs:
build:
name: Build (${{ matrix.name }})
runs-on: ${{ matrix.os }}

```
strategy:
  matrix:
    include:
      - name: macos-intel
        os: macos-latest
        arch: x86_64
      - name: macos-arm
        os: macos-latest
        arch: arm64
      - name: linux
        os: ubuntu-latest
        arch: native
      - name: windows
        os: windows-latest
        arch: native

steps:
  - name: Checkout repository
    uses: actions/checkout@v4

  - name: Install Linux dependencies
    if: matrix.os == 'ubuntu-latest'
    run: |
      sudo apt-get update
      sudo apt-get install -y \
        build-essential \
        libgl1-mesa-dev \
        libx11-dev \
        libxcursor-dev \
        libxrandr-dev \
        libxinerama-dev \
        libxi-dev

  - name: Download VCV Rack SDK
    run: |
      git clone --depth=1 https://github.com/VCVRack/Rack-SDK.git

  - name: Build plugin (macOS)
    if: matrix.os == 'macos-latest'
    env:
      RACK_DIR: ${{ github.workspace }}/Rack-SDK
      ARCH_FLAGS: "-arch ${{ matrix.arch }}"
    run: |
      make clean
      make CXXFLAGS="$ARCH_FLAGS" LDFLAGS="$ARCH_FLAGS"

  - name: Build plugin (Linux / Windows)
    if: matrix.os != 'macos-latest'
    env:
      RACK_DIR: ${{ github.workspace }}/Rack-SDK
    run: |
      make clean
      make

  - name: Package plugin
    shell: bash
    run: |
      mkdir -p dist
      cp -r plugin dist/
      cd dist
      zip -r "${{ github.repository }}-${{ matrix.name }}.zip" plugin

  - name: Upload artifact
    uses: actions/upload-artifact@v4
    with:
      name: ${{ github.repository }}-${{ matrix.name }}
      path: dist/*.zip
```
